statement ok
CREATE DATABASE IF NOT EXISTS test_window_range

statement ok
USE test_window_range

# Test cases from DuckDB test_window_range.test

statement ok
DROP TABLE IF EXISTS t1;

statement ok
CREATE TABLE t1(a FLOAT, b INTEGER);

statement ok
INSERT INTO t1 VALUES
  (5, 10), (10, 20), (13, 26), (13, 26),
  (15, 30), (20, 40), (22,80), (30, 90);

# Binding errors
statement error
SELECT CAST(a AS INTEGER), sum(b) OVER win FROM t1 WINDOW win AS ( ORDER BY a, b RANGE BETWEEN 5 PRECEDING AND 5 FOLLOWING )

statement error
SELECT CAST(a AS INTEGER), sum(b) OVER win FROM t1 WINDOW win AS ( ORDER BY a RANGE BETWEEN 'a' PRECEDING AND 'a' FOLLOWING )

# SQLite RANGE queries
query II
SELECT CAST(a AS INTEGER), sum(b) OVER win FROM t1 WINDOW win AS ( ORDER BY a RANGE BETWEEN 5 PRECEDING AND 5 FOLLOWING )
----
5	30
10	112
13	102
13	102
15	142
20	150
22	120
30	90

query II
SELECT CAST(a AS INTEGER), sum(b) OVER win FROM t1 WINDOW win AS ( ORDER BY a RANGE BETWEEN 10 PRECEDING AND 5 PRECEDING )
----
5	NULL
10	10
13	10
13	10
15	30
20	102
22	82
30	120

query II
SELECT CAST(a AS INTEGER), sum(b) OVER win FROM t1 WINDOW win AS ( ORDER BY a RANGE BETWEEN 2 FOLLOWING AND 3 FOLLOWING )
----
5	NULL
10	52
13	30
13	30
15	NULL
20	80
22	NULL
30	NULL

query II
SELECT CAST(a AS INTEGER), sum(b) OVER win FROM t1 WINDOW win AS ( ORDER BY a DESC RANGE BETWEEN 5 PRECEDING AND 5 FOLLOWING )
----
30	90
22	120
20	150
15	142
13	102
13	102
10	112
5	30

query II
SELECT CAST(a AS INTEGER), sum(b) OVER win FROM t1 WINDOW win AS ( ORDER BY a DESC RANGE BETWEEN 10 PRECEDING AND 5 PRECEDING )
----
30	NULL
22	90
20	90
15	120
13	120
13	120
10	70
5	102

query II
SELECT CAST(a AS INTEGER), sum(b) OVER win FROM t1 WINDOW win AS ( ORDER BY a DESC RANGE BETWEEN 2 FOLLOWING AND 3 FOLLOWING )
----
30	NULL
22	40
20	NULL
15	52
13	20
13	20
10	NULL
5	NULL

statement ok
DROP DATABASE test_window_range